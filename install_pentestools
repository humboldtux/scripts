#!/usr/bin/env bash

#TODO
# https://github.com/hakluke
# https://github.com/lc
# https://github.com/projectdiscovery
# https://github.com/tomnomnom

PKGS_GO="github.com/ffuf/ffuf \
  github.com/OWASP/Amass/v3/... \
  github.com/tomnomnom/httprobe \
  github.com/0xsha/GoLinkFinder \
  github.com/003random/getJS \
  github.com/projectdiscovery/subfinder/v2/cmd/subfinder \
  github.com/haccer/subjack \
  github.com/jpillora/chisel \
  github.com/utkusen/urlhunter \
  github.com/m4dm0e/dirdar \
  github.com/lukasikic/subzy"

for PKG in ${PKGS_GO}; do
  go get -v ${PKG}
done

PIPX_PKGS="sublist3r dnsgen arjun pwncat sqlmap dirsearch awscli"
echo "Installation logiciels pipx: ${PIPX_PKGS}"
for PKG in ${PIPX_PKGS}; do
  if [[ ! -d "${HOME}/.local/pipx/venvs/${PKG}" ]];then
    pipx install ${PKG}
  fi
done

echo "Installation pkgs cargo"
CARGO_PKGS="lychee feroxbuster rustscan findomain"
for PKG in ${CARGO_PKGS}; do
  cargo install ${PKG}
done
asdf reshim rust

DEB_PKGS="nmap rlwrap socat netcat-traditional"
sudo apt install -y ${DEB_PKGS}

if ! dpkg-query -W -f='${Status}' stegseek  | grep "ok installed"
then
  wget -q $(curl -sL https://api.github.com/repos/RickdeJager/stegseek/releases/latest | jq -r '.assets[].browser_download_url') \
    -O /tmp/stegseek.deb && sudo apt install -y /tmp/stegseek.deb > /dev/null
fi

sudo gem install wpscan > /dev/null

NIX_PKGS="hydra"

#sudo -E sh -c 'echo 1 > /proc/sys/vm/overcommit_memory' # probleme memoire
echo "Installation pkg nix"
for PKG in ${NIX_PKGS}; do
  if [[ ! -L "${HOME}/.nix-profile/bin/${PKG}" ]]; then
    nix-env -i ${PKG}
  fi
done

if [[ ! -f "${HOME}/bin/massdns" ]];then
  echo "Installing MassDns"
  git clone https://github.com/blechschmidt/massdns.git /tmp/massdns
  make -C /tmp/massdns/
  mv /tmp/massdns/bin/massdns ${HOME}/bin/massdns
  echo "Done!"
fi

sudo mkdir -p /opt/wordlists
if [[ ! -d /opt/wordlists/SecLists ]]; then
  sudo git clone --depth 1 https://github.com/danielmiessler/SecLists.git /opt/wordlists/SecLists
fi
if [[ ! -d /opt/wordlists/rockyou.txt ]]; then
  wget -q https://download.weakpass.com/wordlists/90/rockyou.txt.gz && gunzip rockyou.txt.gz && sudo mv rockyou.txt /opt/wordlists/
fi

sudo mkdir -p /opt/revshells
if [[ ! -d /opt/wordlists/SecLists ]]; then
  sudo git clone --depth 1 https://github.com/samratashok/nishang.git /opt/revshells/nishang
fi

if [[ ! -f /opt/revshells/pentestmonkey-revshell.php ]]; then
  sudo wget -q https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php -O /opt/revshells/pentestmonkey-revshell.php
fi
