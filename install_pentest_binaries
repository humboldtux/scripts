#!/bin/bash

if [[ $1 == '-u' ]];then
  WGET='wget -N' # only download if version is newer
else
  WGET='wget --no-clobber' #only download if file does not exist
fi

source ${HOME}/.bash_functions

ROOTDIR="/opt/binaries"
LINUXDIR="${ROOTDIR}/linux"
WINDOWSDIR="${ROOTDIR}/windows"

sudo mkdir -p ${LINUXDIR} ${WINDOWSDIR}

echo "Starting retrieving Linux resources"
cd ${LINUXDIR}
sudo ${WGET} -q `github_get_latest_dwd jpillora/chisel linux_amd64` -O /tmp/chisel_linux_amd64.gz && sudo gunzip -q -k -c /tmp/chisel_linux_amd64.gz > /tmp/chisel64 && sudo mv /tmp/chisel64 .
sudo ${WGET} -q `github_get_latest_dwd jpillora/chisel linux_386` -O /tmp/chisel_linux_386.gz && sudo gunzip -q -k -c /tmp/chisel_linux_386.gz > /tmp/chisel32 && sudo mv /tmp/chisel32 .
sudo ${WGET} -q https://raw.githubusercontent.com/jondonas/linux-exploit-suggester-2/master/linux-exploit-suggester-2.pl -O linux-exploit-suggester-2.pl
sudo ${WGET} -q https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/linPEAS/linpeas.sh -O linpeas.sh
sudo ${WGET} -q https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh -O linux-exploit-suggester.sh
sudo ${WGET} -q https://raw.githubusercontent.com/sleventyeleven/linuxprivchecker/master/linuxprivchecker.py -O linuxprivchecker.py
sudo ${WGET} -q https://github.com/ernw/static-toolbox/releases/download/nmap-v7.91SVN/nmap-7.91SVN-x86_64-portable.tar.gz
sudo ${WGET} -q https://github.com/ernw/static-toolbox/releases/download/nmap-v7.91SVN/nmap-7.91SVN-x86-portable.tar.gz
sudo ${WGET} -q https://github.com/ernw/static-toolbox/releases/download/socat-v1.7.4.1/socat-1.7.4.1-x86_64 -O socat64
sudo ${WGET} -q https://github.com/ernw/static-toolbox/releases/download/socat-v1.7.4.1/socat-1.7.4.1-x86 -O socat32
sudo ${WGET} -q https://raw.githubusercontent.com/diego-treitos/linux-smart-enumeration/master/lse.sh -O lse.sh
sudo ${WGET} -q https://raw.githubusercontent.com/TH3xACE/SUDO_KILLER/master/extract.sh -O sudo-extractor.sh
sudo ${WGET} -q https://raw.githubusercontent.com/Anon-Exploiter/SUID3NUM/master/suid3num.py -O suid3num.py
sudo ${WGET} -q https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy32s -O pspy32s
sudo ${WGET} -q https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64s -O pspy64s
sudo ${WGET} -q https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy32 -O pspy32
sudo ${WGET} -q https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64 -O pspy64
sudo chmod a+x ${LINUXDIR}/*

echo "Starting retrieving Windows resources"
cd ${WINDOWSDIR}
sudo ${WGET} -q https://sourceforge.net/projects/unix-utils/files/socat/1.7.3.2/socat-1.7.3.2-1-x86_64.zip/download -O /tmp/socat-1.7.3.2-1-x86_64.zip && sudo unzip -qjo /tmp/socat-1.7.3.2-1-x86_64.zip socat-1.7.3.2-1-x86_64/socat.exe && sudo mv socat.exe socat64.exe
sudo ${WGET} -q https://sourceforge.net/projects/unix-utils/files/socat/1.7.3.2/socat-1.7.3.2-1-i686.zip/download -O /tmp/socat-1.7.3.2-1-i686.zip && sudo unzip -qjo /tmp/socat-1.7.3.2-1-i686.zip socat-1.7.3.2-1-i686/socat.exe && sudo mv socat.exe socat32.exe
sudo ${WGET} -q `github_get_latest_dwd jpillora/chisel windows_386` -O /tmp/chisel_windows_386.gz && sudo gunzip -q -k -c /tmp/chisel_windows_386.gz > /tmp/chisel32.exe && sudo mv /tmp/chisel32.exe .
sudo ${WGET} -q `github_get_latest_dwd jpillora/chisel windows` -O /tmp/chisel_windows_amd64.gz && sudo gunzip -q -k -c /tmp/chisel_windows_amd64.gz > /tmp/chisel64.exe && sudo mv /tmp/chisel64.exe .
sudo ${WGET} -q https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/winPEAS/winPEASexe/binaries/Obfuscated%20Releases/winPEASx64.exe -O winPEASx64.exe
sudo ${WGET} -q https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/winPEAS/winPEASexe/binaries/Obfuscated%20Releases/winPEASx86.exe -O winPEASx86.exe
sudo ${WGET} -q https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/winPEAS/winPEASexe/binaries/Obfuscated%20Releases/winPEASany.exe -O winPEASany.exe
sudo ${WGET} -q https://nmap.org/dist/ncat-portable-5.59BETA1.zip -O /tmp/ncat-portable-5.59BETA1.zip && sudo unzip -qjo /tmp/ncat-portable-5.59BETA1.zip ncat-portable-5.59BETA1/ncat.exe
sudo ${WGET} -q `github_get_latest_dwd gentilkiwi/mimikatz mimikatz_trunk.zip` -O /tmp/mimikatz_trunk.zip && sudo unzip -qu /tmp/mimikatz_trunk.zip -d mimikatz
sudo ${WGET} -q https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/winPEAS/winPEASbat/winPEAS.bat -O winPEAS.bat
sudo ${WGET} -q https://raw.githubusercontent.com/MScholtes/TechNet-Gallery/master/Powershell%20Webserver/Start-WebServer.ps1 -O Start-WebServer.ps1
sudo ${WGET} -q https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1 -O Invoke-Mimikatz.ps1
sudo ${WGET} -q https://download.sysinternals.com/files/AccessChk.zip -O /tmp/AccessChk.zip && sudo unzip -qo /tmp/AccessChk.zip accesschk*
sudo ${WGET} -q https://raw.githubusercontent.com/samratashok/ADModule/master/Import-ActiveDirectory.ps1 -O Import-ActiveDirectory.ps1
sudo ${WGET} -q https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerView/powerview.ps1 -O powerview.ps1
sudo ${WGET} -q https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/Collectors/SharpHound.exe -O SharpHound.exe
sudo ${WGET} -q https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/Collectors/SharpHound.ps1 -O SharpHound.ps1
sudo ${WGET} -q https://raw.githubusercontent.com/itm4n/PrivescCheck/master/PrivescCheck.ps1 -O PrivescCheck.ps1
sudo ${WGET} -q https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1 -O powercat.ps1
sudo ${WGET} -q https://raw.githubusercontent.com/trustedsec/unicorn/master/unicorn.py -O unicorn.py
sudo ${WGET} -q https://the.earth.li/~sgtatham/putty/latest/w32/plink.exe -O plinkw32.exe
sudo ${WGET} -q https://the.earth.li/~sgtatham/putty/latest/w64/plink.exe -O plinkw64.exe
sudo ${WGET} -q https://github.com/int0x33/nc.exe/raw/master/nc64.exe -O nc64.exe
sudo ${WGET} -q https://github.com/int0x33/nc.exe/raw/master/nc.exe -O nc.exe
sudo ${WGET} -q `github_get_latest_dwd hlldz/dazzleUP dazzleUP.x64.exe`
if [[ ! -d 'SharpCollection' ]]; then
  sudo git clone --quiet --depth 1 https://github.com/Flangvik/SharpCollection
  if [[ $1 == '-u' ]];then
    cd SharpCollection && sudo git pull --quiet
  fi
fi
